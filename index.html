<!DOCTYPE html>
<html lang="pt-BR">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>Paranรก Peรงas Toledo - Removedor de Fundo</title>
ย ย <style>
ย ย ย ย body {
ย ย ย ย ย ย font-family: 'Inter', sans-serif;
ย ย ย ย ย ย background-color: #0a0a0a; /* Fundo mais escuro */
ย ย ย ย ย ย color: #f5f5f5;
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย padding: 20px;
ย ย ย ย }
ย ย ย ย h1 {
ย ย ย ย ย ย color: #ff9800; /* Laranja */
ย ย ย ย ย ย font-size: 36px;
ย ย ย ย ย ย margin-bottom: 5px;
ย ย ย ย ย ย font-weight: 700;
ย ย ย ย }
        .subtitle {
            color: #ccc;
            font-size: 18px;
            margin-top: 5px;
            margin-bottom: 30px;
        }
ย ย ย ย .custom-file {
ย ย ย ย ย ย display: inline-block;
ย ย ย ย ย ย padding: 60px 50px;
ย ย ย ย ย ย background-color: #181818; /* Card escuro */
ย ย ย ย ย ย border: 2px dashed #ff9800;
ย ย ย ย ย ย border-radius: 12px;
ย ย ย ย ย ย color: #ff9800;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย cursor: pointer;
            transition: all 0.3s ease;
ย ย ย ย }
ย ย ย ย .custom-file:hover {
ย ย ย ย ย ย background-color: #2c2c2c;
ย ย ย ย ย ย border-color: #e68900;
ย ย ย ย }
ย ย ย ย .custom-file input {
ย ย ย ย ย ย display: none;
ย ย ย ย }
ย ย ย ย button {
ย ย ย ย ย ย background-color: #ff9800;
ย ย ย ย ย ย border: none;
ย ย ย ย ย ย padding: 10px 16px;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย color: #1e1e1e;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย margin: 5px;
            transition: 0.3s;
ย ย ย ย }
ย ย ย ย button:hover {
ย ย ย ย ย ย background-color: #e68900;
ย ย ย ย }
        #limparBtn {
            background-color: #d32f2f;
            color: #fff;
        }
        #limparBtn:hover {
            background-color: #a60000;
        }
ย ย ย ย #resultado, #previewContainer {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย flex-wrap: wrap;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย margin-top: 30px;
ย ย ย ย ย ย gap: 20px;
ย ย ย ย }
ย ย ย ย .card {
ย ย ย ย ย ย background-color: #181818;
ย ย ย ย ย ย padding: 15px;
ย ย ย ย ย ย border-radius: 12px;
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย max-width: 220px;
ย ย ย ย ย ย box-shadow: 0px 4px 10px rgba(0,0,0,0.5);
ย ย ย ย }
ย ย ย ย .card img {
ย ย ย ย ย ย max-width: 200px;
ย ย ย ย ย ย max-height: 200px;
ย ย ย ย ย ย object-fit: contain;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย display: block;
ย ย ย ย ย ย margin-bottom: 10px;
             /* Simula fundo quadriculado para PNG */
ย ย ย ย ย ย background-image: linear-gradient(45deg, #333 25%, transparent 25%), linear-gradient(-45deg, #333 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #333 75%), linear-gradient(-45deg, transparent 75%, #333 75%);
ย ย ย ย ย ย background-size: 20px 20px;
ย ย ย ย ย ย background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
ย ย ย ย }
ย ย ย ย .download-btn {
ย ย ย ย ย ย display: inline-block;
ย ย ย ย ย ย background-color: #ff9800;
ย ย ย ย ย ย color: #1e1e1e;
ย ย ย ย ย ย padding: 8px 12px;
ย ย ย ย ย ย border-radius: 6px;
ย ย ย ย ย ย text-decoration: none;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย }
ย ย ย ย .download-btn:hover {
ย ย ย ย ย ย background-color: #e68900;
ย ย ย ย }
ย ย ย ย .preview-img {
ย ย ย ย ย ย max-width: 100px;
ย ย ย ย ย ย max-height: 100px;
ย ย ย ย ย ย object-fit: cover;
ย ย ย ย ย ย border-radius: 6px;
ย ย ย ย ย ย box-shadow: 0 0 5px rgba(0,0,0,0.4);
ย ย ย ย }
ย ย ย ย #loader {
ย ย ย ย ย ย display: none;
ย ย ย ย ย ย position: fixed;
ย ย ย ย ย ย top: 0; left: 0;
ย ย ย ย ย ย width: 100%; height: 100%;
ย ย ย ย ย ย background: rgba(10, 10, 10, 0.9);
ย ย ย ย ย ย z-index: 9999;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย align-items: center;
ย ย ย ย }
ย ย ย ย .spinner {
ย ย ย ย ย ย border: 6px solid #333;
ย ย ย ย ย ย border-top: 6px solid #ff9800;
ย ย ย ย ย ย border-radius: 50%;
ย ย ย ย ย ย width: 60px;
ย ย ย ย ย ย height: 60px;
ย ย ย ย ย ย animation: spin 0.8s linear infinite;
ย ย ย ย }
ย ย ย ย @keyframes spin {
ย ย ย ย ย ย 0% { transform: rotate(0deg); }
ย ย ย ย ย ย 100% { transform: rotate(360deg); }
ย ย ย ย }
ย ย </style>
</head>
<body>ยย
ย ย <h1>PARANร PEรAS TOLEDO</h1>
    <div class="subtitle">Removedor de Fundo de Imagens</div>
ยย

ย ย <label id="fileLabel" class="custom-file">
ย ย ย ย โ INICIAR COM IMAGENS
ย ย ย ย <input type="file" id="fileInput" multiple onchange="mostrarPreview()">
ย ย </label>

ย ย <div id="previewContainer" style="display:none;"></div>

ย ย <br>
ย ย <button onclick="enviar()">PROCESSAR</button>
ย ย <button id="baixarTodasBtn" style="display:none;" onclick="baixarTodas()">โฌ Baixar Todas</button>
ย ย <button id="limparBtn" onclick="limparImagens()">๐ Limpar Imagens</button>

ย ย <h2 style="color:#ff9800;"></h2>
ย ย <div id="resultado"></div>

ย ย <div id="loader">
ย ย ย ย <div class="spinner"></div>
ย ย </div>

ย ย <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
ย ย <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

ย ย <script>
ย ย ย ย let imagensProcessadas = [];

ย ย ย ย function mostrarPreview() {
ย ย ย ย ย ย const previewDiv = document.getElementById("previewContainer");
ย ย ย ย ย ย previewDiv.innerHTML = "";
ย ย ย ย ย ย const files = document.getElementById("fileInput").files;

ย ย ย ย ย ย if (files.length > 0) {
ย ย ย ย ย ย ย ย document.getElementById("fileLabel").style.display = "none";
ย ย ย ย ย ย ย ย previewDiv.style.display = "flex";
ย ย ย ย ย ย }

ย ย ย ย ย ย for (const file of files) {
ย ย ย ย ย ย ย ย const reader = new FileReader();
ย ย ย ย ย ย ย ย reader.onload = function(e) {
ย ย ย ย ย ย ย ย ย ย const img = document.createElement("img");
ย ย ย ย ย ย ย ย ย ย img.src = e.target.result;
ย ย ย ย ย ย ย ย ย ย img.classList.add("preview-img");
ย ย ย ย ย ย ย ย ย ย previewDiv.appendChild(img);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย reader.readAsDataURL(file);
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function limparImagens() {
ย ย ย ย ย ย document.getElementById("fileInput").value = "";
ย ย ย ย ย ย document.getElementById("previewContainer").innerHTML = "";
ย ย ย ย ย ย document.getElementById("resultado").innerHTML = "";
ย ย ย ย ย ย imagensProcessadas = [];
ย ย ย ย ย ย document.getElementById("baixarTodasBtn").style.display = "none";
ย ย ย ย ย ย document.getElementById("fileLabel").style.display = "inline-block";
ย ย ย ย ย ย document.getElementById("previewContainer").style.display = "none";
ย ย ย ย }

ย ย ย ย async function enviar() {
ย ย ย ย ย ย const files = document.getElementById("fileInput").files;
ย ย ย ย ย ย if (files.length === 0) {
ย ย ย ย ย ย ย ย alert("Selecione pelo menos uma imagem.");
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }

ย ย ย ย ย ย document.getElementById("loader").style.display = "flex";

ย ย ย ย ย ย const formData = new FormData();
ย ย ย ย ย ย for (const file of files) {
ย ย ย ย ย ย ย ย formData.append("imagens", file);
ย ย ย ย ย ย }

ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ยย
                // USA A ROTA RELATIVA CORRETA PARA VERCEL/RENDER
ย ย ย ย ย ย ย ย const res = await fetch("/remover-fundo", {
ย ย ย ย ย ย ย ย ย ย method: "POST",
ย ย ย ย ย ย ย ย ย ย body: formData
ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย if (!res.ok) {
ย ย ย ย ย ย ย ย ย ย const errorData = await res.json();
ย ย ย ย ย ย ย ย ย ย throw new Error(errorData.erro || "Erro desconhecido ao processar imagens");
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย const data = await res.json();
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย
ย ย ย ย ย ย ย ย imagensProcessadas = data.imagens;
ย ย ย ย ย ย ย ย document.getElementById("baixarTodasBtn").style.display = "inline-block";

ย ย ย ย ย ย ย ย const div = document.getElementById("resultado");
ย ย ย ย ย ย ย ย div.innerHTML = "";

ย ย ย ย ย ย ย ย data.imagens.forEach((imgUrl, index) => {ย
ย ย ย ย ย ย ย ย ย ย const card = document.createElement("div");
ย ย ย ย ย ย ย ย ย ย card.classList.add("card");

ย ย ย ย ย ย ย ย ย ย const img = document.createElement("img");
ย ย ย ย ย ย ย ย ย ย img.src = imgUrl;ย

ย ย ย ย ย ย ย ย ย ย const link = document.createElement("a");
ย ย ย ย ย ย ย ย ย ย link.href = imgUrl;ย
ย ย ย ย ย ย ย ย ย ย link.download = `imagem_processada_${index + 1}.png`;ย
ย ย ย ย ย ย ย ย ย ย link.textContent = "โฌ Baixar";
ย ย ย ย ย ย ย ย ย ย link.classList.add("download-btn");

ย ย ย ย ย ย ย ย ย ย card.appendChild(img);
ย ย ย ย ย ย ย ย ย ย card.appendChild(link);
ย ย ย ย ย ย ย ย ย ย div.appendChild(card);
ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย } catch (err) {
ย ย ย ย ย ย ย ย console.error(err);
ย ย ย ย ย ย ย ย alert(`Ocorreu um erro: ${err.message}. Verifique os logs do servidor.`);
ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย document.getElementById("loader").style.display = "none";
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ยย

ย ย ย ย function baixarTodas() {
ย ย ย ย ย ย if (imagensProcessadas.length === 0) return;

ย ย ย ย ย ย const zip = new JSZip();
ย ย ย ย ย ย const promises = [];

ย ย ย ย ย ย document.getElementById("loader").style.display = "flex";ย

ย ย ย ย ย ย imagensProcessadas.forEach((imgUrl, index) => {
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const promise = fetch(imgUrl)
ย ย ย ย ย ย ย ย ย ย .then(res => {
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย if (!res.ok) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย throw new Error(`Falha no download da imagem ${index + 1}. Status: ${res.status}`);
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย return res.blob();
ย ย ย ย ย ย ย ย ย ย })
ย ย ย ย ย ย ย ย ย ย .then(blob => {
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย zip.file(`imagem_processada_${index + 1}.png`, blob);
ย ย ย ย ย ย ย ย ย ย })
ย ย ย ย ย ย ย ย ย ย .catch(error => {
ย ย ย ย ย ย ย ย ย ย ย ย console.error(`Falha ao baixar ${imgUrl}:`, error);
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย zip.file(`erro_download_${index + 1}.txt`, `${error.message}. URL: ${imgUrl}`);
ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย promises.push(promise);
ย ย ย ย ย ย });

ย ย ย ย ย ยย
ย ย ย ย ย ย Promise.all(promises)
ย ย ย ย ย ย ย ย .then(() => {
ย ย ย ย ย ย ย ย ย ย
ย ย ย ย ย ย ย ย ย ย return zip.generateAsync({ type: "blob" });
ย ย ย ย ย ย ย ย })
ย ย ย ย ย ย ย ย .then(content => {
ย ย ย ย ย ย ย ย ย ย
ย ย ย ย ย ย ย ย ย ย saveAs(content, "imagens_processadas_prpecas.zip");
ย ย ย ย ย ย ย ย })
ย ย ย ย ย ย ย ย .catch(error => {
ย ย ย ย ย ย ย ย ย ย console.error("Erro ao gerar ou salvar o ZIP:", error);
ย ย ย ย ย ย ย ย ย ย alert("Ocorreu um erro ao compactar as imagens. Tente novamente.");
ย ย ย ย ย ย ย ย })
ย ย ย ย ย ย ย ย .finally(() => {
ย ย ย ย ย ย ย ย ย ย document.getElementById("loader").style.display = "none";ย
ย ย ย ย ย ย ย ย });
ย ย ย ย }
ย ย </script>
</body>
</html>
